@page
@model NETCSHARP_FRONTEND.Pages.HistoryModel
@{
}
<!-- Header -->
<header class="ds-header">
    <div class="ds-header-left ">
        <button class="ds-menu-btn" onclick="toggleSidebar()">☰</button>
        <div class="ds-logo">RentCar</div>
    </div>
    <div class="ds-header-right">
        <button class="ds-btn-header ds-btn-login nav-button">Login</button>
        <button class="ds-btn-header ds-btn-register nav-button">Registrasi</button>
        <span id="sambutan" style="display: none;">
            Hai
        </span>
    </div>
</header>

<!-- Sidebar -->
<div class="ds-sidebar" id="sidebar">
    <div class="ds-sidebar-header">
        <button class="ds-close-btn" onclick="toggleSidebar()">✕</button>
    </div>
    <ul class="ds-sidebar-menu">
        <li><a href="/dashboard">Home</a></li>
        <li><a href="/history">Riwayat Penyewaan</a></li>
        <li><a href="/about">Kontak Kami</a></li>
    </ul>
</div>

<!-- Overlay -->
<div class="ds-overlay" id="overlay" onclick="toggleSidebar()"></div>

<div>
    <center><h1>Riwayat Pesanan</h1></center>
    <div class="tb-container">
        <table class="tb-table" id="rentalTable">
            <thead>
                <tr>
                    <th>Tanggal Sewa</th>
                    <th>Mobil</th>
                    <th>Harga Sewa per Hari</th>
                    <th>Total Hari</th>
                    <th>Total Harga</th>
                    <th>Status Pembayaran</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>


<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        sidebar.classList.toggle('ds-active');
        overlay.classList.toggle('ds-active');
    }

    async function check(){
            var jew = new JWTManager();
            let x =  await jew.validate();
            console.log(x)
            if(!x.valid){
                alert('your session has been expired')
              
            }
            else {
                const elements = document.querySelectorAll('.nav-button');
                elements.forEach(element => {
                    element.style.display = 'none';
                });
                const result = await core.fetchHistory(jew._getCookie("jwt_token"))
                console.log(result)
                document.getElementById("sambutan").style.display = 'block'
                document.getElementById("sambutan").innerHTML = 'Hai, ' + x.name
                renderTable(result)
            }
    }
      function formatCurrency(amount) {
            return 'Rp. ' + amount.toLocaleString('id-ID');
        }

        function renderTable(data) {
            const tbody = document.querySelector('#rentalTable tbody');
            tbody.innerHTML = '';

            data.forEach(item => {
                const row = document.createElement('tr');

                const statusClass = item.paymentStatus == "COMPLETED" ? "tb-status-paid" : "tb-status-unpaid";

                row.innerHTML = `
                    <td>${item.startdate}</td>
                    <td>${item.name}</td>
                    <td>${formatCurrency(item.priceperday)}</td>
                    <td>${item.totalDays}</td>
                    <td>${formatCurrency(item.totalPrice)}</td>
                    <td><span class="tb-status-badge ${statusClass}">${item.paymentStatus}</span></td>
                `;

                tbody.appendChild(row);
            });
        }
    check()

</script>