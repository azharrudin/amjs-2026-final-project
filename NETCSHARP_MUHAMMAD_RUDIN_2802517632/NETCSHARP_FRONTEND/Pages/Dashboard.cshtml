@page
@model NETCSHARP_FRONTEND.Pages.DashboardModel
@{
}
<!-- Header -->
<header class="ds-header">
    <div class="ds-header-left ">
        <button class="ds-menu-btn" onclick="toggleSidebar()">☰</button>
        <div class="ds-logo">RentCar</div>
    </div>
    <div class="ds-header-right">
        <button class="ds-btn-header ds-btn-login nav-button">Login</button>
        <button class="ds-btn-header ds-btn-register nav-button">Registrasi</button>
        <span id="sambutan" style="display: none;">
            Hai 
        </span>
    </div>
</header>

<!-- Sidebar -->
<div class="ds-sidebar" id="sidebar">
    <div class="ds-sidebar-header">
        <button class="ds-close-btn" onclick="toggleSidebar()">✕</button>
    </div>
    <ul class="ds-sidebar-menu">
        <li><a href="#">Home</a></li>
        <li><a href="#">Riwayat Penyewaan</a></li>
        <li><a href="#">Kontak Kami</a></li>
    </ul>
</div>

<!-- Overlay -->
<div class="ds-overlay" id="overlay" onclick="toggleSidebar()"></div>

<!-- Hero -->
<section class="ds-hero">
    <h1>Selamat Datang di Rental Mobil Kami</h1>

    <!-- Filter Section -->
    <div class="ds-filter-section">
        <div class="ds-filter-row">
            <div class="ds-filter-group">
                <label>Pickup Date:</label>
                <input type="date" value="2024-10-16" id="startdate">
            </div>
            <div class="ds-filter-group">
                <label>Return Date:</label>
                <input type="date" value="2024-10-19" id="returndate">
            </div>
            <div class="ds-filter-group">
                <label>Filter Tahun Pembuatan</label>
                <select>
                    <option>Semua Tahun</option>
                    <option>2023</option>
                    <option>2022</option>
                    <option>2021</option>
                    <option>2020</option>
                    <option>2019</option>
                </select>
            </div>
            <div class="ds-filter-group" style="display: flex; align-items: flex-end;">
                <button class="ds-btn-filter">Cari</button>
            </div>
        </div>
    </div>
</section>

<!-- Sort Section -->
<div class="ds-sort-section">
    <label>Sortir Berdasarkan</label>
    <select>
        <option>Harga Terendah - Tertinggi</option>
        <option>Harga Tertinggi - Terendah</option>
        <option>Tahun Terbaru</option>
        <option>Tahun Terlama</option>
    </select>
</div>

<!-- Car Grid -->
<div class="ds-car-grid">
    <div class="ds-car-card">
        <img src="https://images.unsplash.com/photo-1619767886558-efdc259cde1a?w=400&h=300&fit=crop" alt="Daihatsu Alya" class="ds-car-image">
        <div class="ds-car-info">
            <div class="ds-car-name">Daihatsu Alya AT<br>2019</div>
            <div class="ds-car-price">Harga: Rp. 300.000 / hari</div>
            <button class="ds-btn-rent">Sewa Sekarang</button>
        </div>
    </div>
</div>
<script>
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');

        sidebar.classList.toggle('ds-active');
        overlay.classList.toggle('ds-active');
    }

    // Set default dates
    const today = new Date();
    const pickupDate = today.toISOString().split('T')[0];
    const returnDate = new Date(today.setDate(today.getDate() + 3)).toISOString().split('T')[0];

    document.querySelectorAll('input[type="date"]')[0].value = pickupDate;
    document.querySelectorAll('input[type="date"]')[1].value = returnDate;
    async function check(){
            var jew = new JWTManager();
            let x =  await jew.validate();
            console.log(x)
            if(!x.valid){
                alert('your session has been expired')
                window.location.href = '/login';
            }
            else {
                const elements = document.querySelectorAll('.nav-button');
                elements.forEach(element => {
                    element.style.display = 'none';
                });
                const result = await core.fetchAvailableCar(document.getElementById("startdate").value, document.getElementById('returndate').value)
                console.log(result)
                document.getElementById("sambutan").style.display = 'block'
                loadCarCards(result)
            }
    }
    function formatPrice(price) {
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0
        }).format(price);
    }

    function createCarCard(car) {
        const card = document.createElement('div');
        card.className = 'ds-car-card';
        let link = car.images.length > 0 ? car.images[0].imageLink : ''
        card.innerHTML = `
            <img src="${link}" alt="${car.alt}" class="ds-car-image">
            <div class="ds-car-info">
                <div class="ds-car-name">${car.name}<br>${car.year}</div>
                <div class="ds-car-price">Harga: ${formatPrice(car.pricePerDay)} / hari</div>
                <button class="ds-btn-rent" data-car="${car.name}">Sewa Sekarang</button>
            </div>
        `;

        return card;
    }

    function loadCarCards(carList) {
        const grid = document.querySelector('.ds-car-grid');

        grid.innerHTML = '';

        carList.forEach(car => {
            const card = createCarCard(car);
            grid.appendChild(card);
        });

        attachRentListeners();
    }

    function attachRentListeners() {
        const rentButtons = document.querySelectorAll('.ds-btn-rent');

        rentButtons.forEach(button => {
            button.addEventListener('click', function() {
                const carName = this.getAttribute('data-car');
                handleRent(carName);
            });
        });
    }

    function handleRent(carName) {
        alert(`Anda memilih untuk menyewa: ${carName}`);
    }

   
    check()

</script>